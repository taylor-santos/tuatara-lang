//
// Created by taylor-santos on 2/14/2022 at 12:30.
//

#include "doctest/doctest.h"

#include "printer.hpp"
#include "test_util.hpp"
#include "rang.hpp"

#include <sstream>

DOCTEST_TEST_SUITE_BEGIN("Printer");

TEST_CASE("printer") {
    rang::setWinTermMode(rang::winTerm::Ansi);
    rang::setControlMode(rang::control::Force);
    std::vector<std::string> lines{
        "1234567890",
        "1234567890",
        "1234567890",
        "1234567890",
        "1234567890",
    };
    auto fn = std::string("foobar.tta");
    using namespace print;
    std::stringstream ss;
    {
        Message msg = Message::error(POS(&fn, 2, 4))
                          .with_message("this is an error", color::bold_gray)
                          .with_detail(LOC(&fn, 1, 8, 2, 3), color::bold_red)
                          .with_message("aaaa", color::bold_red)
                          .with_detail(LOC(&fn, 1, 7, 4, 2), color::bold_green)
                          .with_message("bbbb", color::bold_green)
                          .with_detail(LOC(&fn, 2, 4, 2, 6), color::bold_magenta)
                          .with_message("cccc", color::bold_magenta)
                          .with_detail(LOC(&fn, 4, 4, 5, 4), color::bold_yellow)
                          .with_message("dddd", color::bold_yellow)
                          .with_detail(LOC(&fn, 4, 3, 4, 3), color::bold_blue)
                          .with_message("eeee", color::bold_blue)
                          .with_detail(LOC(&fn, 4, 4, 4, 4), color::bold_red)
                          .with_message("llll", color::bold_red)
                          .with_detail(LOC(&fn, 4, 8, 4, 11), color::bold_cyan)
                          .with_message("ffff", color::bold_cyan)
                          .with_detail(LOC(&fn, 3, 1, 3, 4), color::bold_gray)
                          .with_message("gggg", color::bold_gray)
                          .with_detail(LOC(&fn, 3, 9, 3, 11), color::bold_black)
                          .with_message("hhhh", color::bold_black)
                          .with_detail(LOC(&fn, 4, 7, 5, 7), color::red)
                          .with_message("iiii", color::red)
                          .with_detail(LOC(&fn, 3, 5, 3, 8), color::blue)
                          .with_message("jjjj", color::blue)
                          .with_detail(LOC(&fn, 2, 5, 2, 8), color::green)
                          .with_message("kkkk", color::green);

        msg.print(lines, ss);
    }
    {
        Message msg = Message::error(POS(&fn, 1, 2)).with_message("foobar", color::bold_gray);
        msg.print(lines, ss);
    }
    {
        Message msg = Message::error(POS(&fn, 1, 2))
                          .with_message("foobar", color::bold_gray)
                          .with_detail(LOC(&fn, 1, 5, 3, 1), color::bold_red)
                          .with_message("baz", color::bold_gray)
                          .with_detail(LOC(&fn, 4, 1, 4, 2), color::bold_cyan)
                          .with_message("A", color::bold_cyan)
                          .with_detail(LOC(&fn, 4, 5, 4, 6), color::bold_yellow)
                          .with_message("B", color::bold_yellow)
                          .with_detail(LOC(&fn, 4, 9, 4, 10), color::bold_magenta)
                          .with_message("C", color::bold_magenta)
                          .with_detail(LOC(&fn, 5, 1, 5, 2), color::bold_cyan)
                          .with_message("A", color::bold_cyan)
                          .with_detail(LOC(&fn, 5, 5, 5, 6), color::bold_yellow)
                          .with_message("B", color::bold_yellow)
                          .with_detail(LOC(&fn, 5, 8, 5, 9), color::bold_magenta)
                          .with_message("C", color::bold_magenta);
        msg.print(lines, ss);
    }
    auto s = ss.str();

    CHECK(
        s ==
        "\033[0m\033[91m\033[49merror: \033[49m\033[39m\033[0m\033[0m\033[97m\033[49mthis is an "
        "error\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m  "
        "╭─\033[49m\033[39m\033[0m\033[0m\033[37m\033[49m[\033[49m\033[39m\033[0m\033[0m\033["
        "97m\033[49mfoobar.tta:2:4\033[49m\033[39m\033[0m\033[0m\033[37m\033[49m]\033[49m\033["
        "39m\033[0m\n\033[0m\033[37m\033[49m1 │ \033[49m\033[39m\033[0m\033[0m\033[92m\033[49m "
        "╭\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m▶\033[49m\033[39m\033[0m\033[0m\033["
        "91m\033[49m╭\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m──\033[49m\033[39m\033[0m\033["
        "0m\033[91m\033[49m▶ "
        "\033[49m\033[39m\033[0m\033[0m\033[37m\033[49m123456\033[49m\033[39m\033[0m\033[0m\033["
        "92m\033[49m7\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m890\033[49m\033[39m\033[0m\033["
        "0m\033[92m\033[49m\033[49m\033[39m\033[0m\033[0m\033[37m\033[49m\033[49m\033[39m\033["
        "0m\n\033[0m\033[37m\033[49m2 │ \033[49m\033[39m\033[0m\033[0m\033[92m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m "
        "├\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m──\033[49m\033[39m\033[0m\033[0m\033["
        "91m\033[49m▶ "
        "\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m12\033[49m\033[39m\033[0m\033[0m\033["
        "92m\033[49m3\033[49m\033[39m\033[0m\033[0m\033[95m\033[49m4\033[49m\033[39m\033[0m\033["
        "0m\033[32m\033[49m567\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m890\033[49m\033["
        "39m\033[0m\n\033[0m\033[37m\033[49m  · \033[49m\033[39m\033[0m\033[0m\033[92m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[95m\033[49m   "
        "\033[49m\033[39m\033[0m\033[0m\033[32m\033[49m ─── "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[32m\033["
        "49mkkkk\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m  · "
        "\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[95m\033[49m   ── "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[95m\033["
        "49mcccc\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m  · "
        "\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m "
        "╰\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m──\033[49m\033[39m\033[0m\033[0m\033["
        "91m\033[49m──\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m──\033[49m\033[39m\033[0m\033["
        "0m\033[91m\033[49m "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[91m\033["
        "49maaaa\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m3 │ "
        "\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[97m\033[49m123\033[49m\033[39m\033[0m\033[0m\033["
        "92m\033[49m4\033[49m\033[39m\033[0m\033[0m\033[34m\033[49m567\033[49m\033[39m\033[0m\033["
        "0m\033[92m\033[49m8\033[49m\033[39m\033[0m\033[0m\033[90m\033[49m90\033[49m\033[39m\033["
        "0m\033[0m\033[92m\033[49m\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m  · "
        "\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[97m\033[49m───╮\033[49m\033[39m\033[0m\033[0m\033["
        "34m\033[49m───╮\033[49m\033[39m\033[0m\033[0m\033[90m\033[49m── "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[90m\033["
        "49mhhhh\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m  · "
        "\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[97m\033[49m   "
        "│\033[49m\033[39m\033[0m\033[0m\033[34m\033[49m   ╰─ "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[34m\033["
        "49mjjjj\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m  · "
        "\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[97m\033[49m   ╰─ "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[97m\033["
        "49mgggg\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m4 │ "
        "\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m "
        "├\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m▶\033[49m\033[39m\033[0m\033[0m\033["
        "93m\033[49m╭\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m▶\033[49m\033[39m\033[0m\033["
        "0m\033[31m\033[49m╭\033[49m\033[39m\033[0m\033[0m\033[31m\033[49m▶ "
        "\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m1\033[49m\033[39m\033[0m\033[0m\033[37m\033["
        "49m23\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m456\033[49m\033[39m\033[0m\033[0m\033["
        "31m\033[49m7\033[49m\033[39m\033[0m\033[0m\033[96m\033[49m890\033[49m\033[39m\033[0m\033["
        "0m\033[31m\033[49m\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m\033[49m\033[39m\033["
        "0m\033[0m\033[37m\033[49m\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m  · "
        "\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[31m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[94m\033[49m  "
        "▲\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m▲\033[49m\033[39m\033[0m\033[0m\033["
        "96m\033[49m   ─── "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[96m\033["
        "49mffff\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m  · "
        "\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[31m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[94m\033[49m  "
        "│\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m╰─ "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[91m\033["
        "49mllll\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m  · "
        "\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[31m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[94m\033[49m  ╰─ "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[94m\033["
        "49meeee\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m  · "
        "\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m "
        "╰\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m──\033[49m\033[39m\033[0m\033[0m\033["
        "92m\033[49m──\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m──\033[49m\033[39m\033[0m\033["
        "0m\033[92m\033[49m─\033[49m\033[39m\033[0m\033[0m\033[92m\033[49m "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[92m\033["
        "49mbbbb\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m5 │ "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m "
        "├\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m▶\033[49m\033[39m\033[0m\033[0m\033["
        "31m\033[49m├\033[49m\033[39m\033[0m\033[0m\033[31m\033[49m▶ "
        "\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m123\033[49m\033[39m\033[0m\033[0m\033["
        "31m\033[49m456\033[49m\033[39m\033[0m\033[0m\033[37m\033[49m7890\033[49m\033[39m\033["
        "0m\n\033[0m\033[37m\033[49m  · \033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[31m\033[49m "
        "╰\033[49m\033[39m\033[0m\033[0m\033[31m\033[49m──\033[49m\033[39m\033[0m\033[0m\033["
        "31m\033[49m──────\033[49m\033[39m\033[0m\033[0m\033[31m\033[49m "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[31m\033["
        "49miiii\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m  · "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m "
        "╰\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m──\033[49m\033[39m\033[0m\033[0m\033["
        "93m\033[49m──\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m───\033[49m\033[39m\033[0m\033["
        "0m\033[93m\033[49m "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[93m\033["
        "49mdddd\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m──╯\033[49m\033[39m\033[0m\n\033["
        "0m\033[91m\033[49merror: "
        "\033[49m\033[39m\033[0m\033[0m\033[97m\033[49mfoobar\033[49m\033[39m\033[0m\n\033[0m\033["
        "37m\033[49m[\033[49m\033[39m\033[0m\033[0m\033[97m\033[49mfoobar.tta:1:2\033[49m\033["
        "39m\033[0m\033[0m\033[37m\033[49m]\033[49m\033[39m\033[0m\n\033[0m\033[91m\033[49merror: "
        "\033[49m\033[39m\033[0m\033[0m\033[97m\033[49mfoobar\033[49m\033[39m\033[0m\n\033[0m\033["
        "37m\033[49m  "
        "╭─\033[49m\033[39m\033[0m\033[0m\033[37m\033[49m[\033[49m\033[39m\033[0m\033[0m\033["
        "97m\033[49mfoobar.tta:1:2\033[49m\033[39m\033[0m\033[0m\033[37m\033[49m]\033[49m\033["
        "39m\033[0m\n\033[0m\033[37m\033[49m1 │ \033[49m\033[39m\033[0m\033[0m\033[91m\033[49m "
        "╭\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m▶ "
        "\033[49m\033[39m\033[0m\033[0m\033[37m\033[49m1234\033[49m\033[39m\033[0m\033[0m\033["
        "91m\033[49m567890\033[49m\033[39m\033[0m\033[0m\033[37m\033[49m\033[49m\033[39m\033["
        "0m\n\033[0m\033[37m\033[49m2 │ \033[49m\033[39m\033[0m\033[0m\033[91m\033[49m "
        "│\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m1234567890\033[49m\033[39m\033[0m\n\033["
        "0m\033[37m\033[49m3 │ \033[49m\033[39m\033[0m\033[0m\033[91m\033[49m "
        "├\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m▶ "
        "\033[49m\033[39m\033[0m\033[0m\033[37m\033[49m1234567890\033[49m\033[39m\033[0m\n\033["
        "0m\033[37m\033[49m  · \033[49m\033[39m\033[0m\033[0m\033[91m\033[49m "
        "╰\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m──\033[49m\033[39m\033[0m\033[0m\033["
        "91m\033[49m\033[49m\033[39m\033[0m\033[0m\033[91m\033[49m "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[97m\033["
        "49mbaz\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m4 │ "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[96m\033[49m1\033[49m\033[39m\033[0m\033[0m\033[37m\033["
        "49m234\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m5\033[49m\033[39m\033[0m\033[0m\033["
        "37m\033[49m678\033[49m\033[39m\033[0m\033[0m\033[95m\033[49m9\033[49m\033[39m\033[0m\033["
        "0m\033[37m\033[49m0\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m  · "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[96m\033[49m─ "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[96m\033["
        "49mA\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m ─ "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[93m\033["
        "49mB\033[49m\033[39m\033[0m\033[0m\033[95m\033[49m ─ "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[95m\033["
        "49mC\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m5 │ "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[96m\033[49m1\033[49m\033[39m\033[0m\033[0m\033[37m\033["
        "49m234\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m5\033[49m\033[39m\033[0m\033[0m\033["
        "37m\033[49m67\033[49m\033[39m\033[0m\033[0m\033[95m\033[49m8\033[49m\033[39m\033[0m\033["
        "0m\033[37m\033[49m90\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m  · "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[96m\033[49m─ "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[96m\033["
        "49mA\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m "
        "─╮\033[49m\033[39m\033[0m\033[0m\033[95m\033[49m ─ "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[95m\033["
        "49mC\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m  · "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m  "
        "\033[49m\033[39m\033[0m\033[0m\033[93m\033[49m     ╰─ "
        "\033[49m\033[39m\033[0m\033[0m\033[39m\033[49m\033[49m\033[39m\033[0m\033[0m\033[93m\033["
        "49mB\033[49m\033[39m\033[0m\n\033[0m\033[37m\033[49m──╯\033[49m\033[39m\033[0m\n");
}
